#!/usr/bin/env python3
"""Analyze emulator results from the Tuna-9 trio experiments."""

import json
import math

EDGES = [
    (0, 1), (0, 2), (1, 3), (1, 4), (2, 4), (2, 5),
    (3, 6), (4, 6), (4, 7), (5, 7), (6, 8), (7, 8),
]
N = 9
PARTITION_A = {0, 3, 4, 5, 8}

# QI emulator uses little-endian: rightmost bit = q[0]
def bit_at(bitstring, q):
    """Get qubit q from QI bitstring (rightmost = q[0])."""
    return int(bitstring[-(q + 1)])


def qaoa_cost(bitstring):
    cost = 0
    for i, j in EDGES:
        if bit_at(bitstring, i) != bit_at(bitstring, j):
            cost += 1
    return cost


# === GHZ Z-basis ===
ghz_z = {"000000000": 2077, "111111111": 2019}
total = sum(ghz_z.values())
print("=== GHZ Z-basis (emulator) ===")
print(f"P(000000000) = {2077/total:.4f}")
print(f"P(111111111) = {2019/total:.4f}")
print(f"F_z = {(2077 + 2019)/total:.4f}")
print()

# === GHZ X-basis ===
ghz_x_raw = {"000000000": 14, "000000011": 16, "000000101": 14, "000000110": 19, "000001001": 15, "000001010": 18, "000001100": 14, "000001111": 21, "000010001": 19, "000010010": 14, "000010100": 10, "000010111": 15, "000011000": 16, "000011011": 22, "000011101": 8, "000011110": 13, "000100001": 15, "000100010": 21, "000100100": 12, "000100111": 16, "000101000": 18, "000101011": 24, "000101101": 18, "000101110": 19, "000110000": 18, "000110011": 18, "000110101": 15, "000110110": 20, "000111001": 20, "000111010": 6, "000111100": 9, "000111111": 17, "001000001": 12, "001000010": 20, "001000100": 21, "001000111": 12, "001001000": 17, "001001011": 21, "001001101": 18, "001001110": 14, "001010000": 22, "001010011": 13, "001010101": 15, "001010110": 12, "001011001": 19, "001011010": 17, "001011100": 18, "001011111": 21, "001100000": 16, "001100011": 19, "001100101": 15, "001100110": 13, "001101001": 14, "001101010": 12, "001101100": 20, "001101111": 24, "001110001": 15, "001110010": 16, "001110100": 20, "001110111": 14, "001111000": 24, "001111011": 13, "001111101": 19, "001111110": 22, "010000001": 14, "010000010": 25, "010000100": 17, "010000111": 17, "010001000": 15, "010001011": 15, "010001101": 16, "010001110": 11, "010010000": 9, "010010011": 16, "010010101": 14, "010010110": 14, "010011001": 19, "010011010": 21, "010011100": 20, "010011111": 10, "010100000": 15, "010100011": 16, "010100101": 19, "010100110": 12, "010101001": 8, "010101010": 25, "010101100": 15, "010101111": 18, "010110001": 19, "010110010": 22, "010110100": 15, "010110111": 14, "010111000": 22, "010111011": 16, "010111101": 25, "010111110": 13, "011000000": 16, "011000011": 15, "011000101": 18, "011000110": 10, "011001001": 17, "011001010": 10, "011001100": 14, "011001111": 16, "011010001": 17, "011010010": 25, "011010100": 15, "011010111": 11, "011011000": 22, "011011011": 11, "011011101": 15, "011011110": 8, "011100001": 12, "011100010": 13, "011100100": 13, "011100111": 14, "011101000": 16, "011101011": 16, "011101101": 11, "011101110": 15, "011110000": 18, "011110011": 22, "011110101": 12, "011110110": 23, "011111001": 10, "011111010": 16, "011111100": 14, "011111111": 16, "100000001": 14, "100000010": 12, "100000100": 13, "100000111": 14, "100001000": 20, "100001011": 17, "100001101": 15, "100001110": 20, "100010000": 12, "100010011": 12, "100010101": 12, "100010110": 18, "100011001": 16, "100011010": 13, "100011100": 17, "100011111": 13, "100100000": 15, "100100011": 17, "100100101": 19, "100100110": 13, "100101001": 17, "100101010": 11, "100101100": 21, "100101111": 13, "100110001": 13, "100110010": 28, "100110100": 17, "100110111": 20, "100111000": 11, "100111011": 11, "100111101": 18, "100111110": 20, "101000000": 15, "101000011": 19, "101000101": 10, "101000110": 17, "101001001": 20, "101001010": 18, "101001100": 19, "101001111": 19, "101010001": 19, "101010010": 18, "101010100": 10, "101010111": 21, "101011000": 18, "101011011": 9, "101011101": 12, "101011110": 22, "101100001": 19, "101100010": 19, "101100100": 17, "101100111": 13, "101101000": 10, "101101011": 15, "101101101": 16, "101101110": 13, "101110000": 17, "101110011": 12, "101110101": 13, "101110110": 12, "101111001": 10, "101111010": 10, "101111100": 18, "101111111": 17, "110000000": 16, "110000011": 17, "110000101": 12, "110000110": 15, "110001001": 22, "110001010": 13, "110001100": 12, "110001111": 16, "110010001": 14, "110010010": 17, "110010100": 21, "110010111": 15, "110011000": 12, "110011011": 22, "110011101": 13, "110011110": 9, "110100001": 10, "110100010": 15, "110100100": 13, "110100111": 23, "110101000": 15, "110101011": 29, "110101101": 17, "110101110": 16, "110110000": 26, "110110011": 19, "110110101": 14, "110110110": 16, "110111001": 9, "110111010": 22, "110111100": 20, "110111111": 21, "111000001": 15, "111000010": 24, "111000100": 10, "111000111": 13, "111001000": 13, "111001011": 16, "111001101": 11, "111001110": 14, "111010000": 15, "111010011": 20, "111010101": 20, "111010110": 17, "111011001": 10, "111011010": 13, "111011100": 19, "111011111": 15, "111100000": 13, "111100011": 11, "111100101": 20, "111100110": 16, "111101001": 8, "111101010": 16, "111101100": 16, "111101111": 17, "111110001": 15, "111110010": 15, "111110100": 15, "111110111": 22, "111111000": 17, "111111011": 16, "111111101": 15, "111111110": 19}

total_x = sum(ghz_x_raw.values())
even = sum(c for bs, c in ghz_x_raw.items() if sum(int(b) for b in bs) % 2 == 0)
odd = sum(c for bs, c in ghz_x_raw.items() if sum(int(b) for b in bs) % 2 != 0)
print("=== GHZ X-basis (emulator) ===")
print(f"P(even parity) = {even/total_x:.4f}")
print(f"P(odd parity) = {odd/total_x:.4f}")
print(f"<X^9> = {(even - odd)/total_x:.4f}")
print(f"Unique bitstrings: {len(ghz_x_raw)} (expect 256 even-parity)")
print(f"GHZ fidelity bound: F >= 0.5 * (F_z + |<X^9>|) = {0.5 * (1.0 + abs((even-odd)/total_x)):.4f}")
print()

# === Quantum Walk ===
walk_d1 = {"000000001": 2155, "000000000": 165, "000000011": 183, "000000101": 170, "000001001": 171, "000010001": 156, "000100001": 153, "001000001": 147, "010000001": 154, "100000001": 176}
# Just the top results; real data has more

print("=== Quantum Walk depth=1 (emulator, top results) ===")
print("Bitstring convention: rightmost bit = q[0]")
print()

# Full depth-1 results
walk_d1_full = {"000000000": 165, "000000001": 2155, "000000010": 15, "000000011": 183, "000000100": 12, "000000101": 170, "000000111": 17, "000001000": 14, "000001001": 171, "000001010": 2, "000001011": 11, "000001101": 14, "000001111": 2, "000010000": 14, "000010001": 156, "000010010": 2, "000010011": 12, "000010101": 5, "000010110": 1, "000010111": 2, "000011000": 1, "000011001": 5, "000011010": 1, "000011011": 1, "000011101": 2, "000100000": 12, "000100001": 153, "000100011": 9, "000100100": 1, "000100101": 3, "000101001": 7, "000101011": 2, "000110001": 13, "000110101": 2, "000111001": 3, "001000000": 15, "001000001": 147, "001000011": 8, "001000100": 1, "001000101": 12, "001000111": 1, "001001001": 16, "001010001": 15, "001010011": 1, "001011001": 1, "001100001": 10, "001100011": 2, "001100101": 1, "001101101": 1, "001110001": 1, "010000000": 9, "010000001": 154, "010000010": 1, "010000011": 11, "010000101": 9, "010000111": 1, "010001001": 12, "010001011": 1, "010001101": 1, "010010000": 2, "010010001": 13, "010011001": 1, "010100000": 1, "010100001": 8, "010100101": 1, "011000001": 7, "100000000": 9, "100000001": 176, "100000010": 1, "100000011": 12, "100000101": 9, "100000111": 1, "100001001": 10, "100010000": 1, "100010001": 17, "100010011": 3, "100010101": 1, "100100000": 1, "100100001": 12, "100100010": 1, "100101001": 1, "101000000": 1, "101000001": 11, "101000011": 1, "101000101": 1, "101001001": 1, "101100001": 1, "110000001": 12, "110000010": 1, "110000011": 1, "110000101": 4, "110010001": 1, "110010101": 1, "110100001": 1, "111000001": 1, "111001001": 1}

total_w1 = sum(walk_d1_full.values())
probs_d1 = [0.0] * N
for bs, c in walk_d1_full.items():
    for q in range(N):
        if bit_at(bs, q) == 1:
            probs_d1[q] += c / total_w1

print("Depth 1 — per-qubit P(|1⟩):")
for q in range(N):
    bar = "█" * int(probs_d1[q] * 50)
    neighbors = [j for i, j in EDGES if i == q] + [i for i, j in EDGES if j == q]
    print(f"  q{q}: {probs_d1[q]:.3f} {bar}  (neighbors: {neighbors})")
print()

# Depth 2
walk_d2_full = {"000000000": 119, "000000001": 566, "000000010": 9, "000000011": 9, "000000100": 6, "000000101": 9, "000000110": 7, "000001000": 55, "000001001": 187, "000001010": 2, "000001011": 19, "000001100": 6, "000001101": 3, "000010000": 72, "000010001": 154, "000010010": 2, "000010011": 15, "000010100": 3, "000010101": 14, "000010110": 1, "000010111": 10, "000011000": 10, "000011001": 74, "000011010": 2, "000011011": 9, "000011100": 3, "000011101": 4, "000100000": 49, "000100001": 176, "000100010": 6, "000100011": 3, "000100100": 6, "000100101": 18, "000100110": 1, "000100111": 1, "000101000": 20, "000101001": 69, "000101011": 5, "000101100": 2, "000101101": 2, "000101111": 1, "000110000": 29, "000110001": 62, "000110010": 2, "000110011": 7, "000110101": 7, "000111000": 14, "000111001": 17, "000111010": 1, "000111011": 4, "000111101": 1, "001000000": 74, "001000001": 276, "001000010": 3, "001000100": 6, "001000101": 3, "001001000": 3, "001001001": 15, "001010000": 5, "001010001": 18, "001010010": 1, "001011000": 1, "001011001": 6, "001011101": 1, "001100000": 32, "001100001": 90, "001100100": 4, "001100101": 6, "001101001": 1, "001101101": 1, "001110001": 2, "001111001": 2, "010000000": 79, "010000001": 282, "010000010": 4, "010000011": 1, "010000100": 5, "010000110": 3, "010001000": 34, "010001001": 121, "010001010": 3, "010001011": 8, "010001100": 3, "010001110": 1, "010010000": 3, "010010001": 18, "010011000": 1, "010011001": 7, "010011010": 1, "010011100": 1, "010100000": 1, "010100001": 9, "010100110": 1, "010101000": 2, "010101001": 6, "010110000": 3, "010111000": 1, "010111001": 1, "011000000": 26, "011000001": 113, "011000010": 3, "011000100": 2, "011001000": 2, "011001001": 7, "011001100": 1, "011010000": 1, "011010001": 7, "011100000": 4, "011100001": 12, "011101111": 1, "011110001": 2, "011111000": 1, "100000000": 51, "100000001": 306, "100000010": 1, "100000011": 3, "100000100": 6, "100000101": 1, "100000110": 1, "100000111": 1, "100001000": 22, "100001001": 75, "100001010": 2, "100001011": 5, "100010000": 16, "100010001": 67, "100010011": 6, "100010100": 4, "100010101": 3, "100011000": 5, "100011001": 26, "100011010": 1, "100011101": 3, "100011111": 1, "100100000": 20, "100100001": 71, "100100101": 8, "100101000": 10, "100101001": 21, "100101010": 2, "100101011": 2, "100101101": 2, "100101111": 1, "100110000": 6, "100110001": 18, "100110010": 1, "100110011": 1, "100111000": 1, "100111001": 4, "100111101": 1, "101000000": 3, "101000001": 24, "101001000": 1, "101001001": 2, "101010001": 6, "101010100": 1, "101011000": 4, "101011001": 1, "101100000": 1, "101100001": 3, "101101001": 2, "101101011": 1, "101110000": 1, "101110001": 1, "101111001": 1, "110000000": 4, "110000001": 16, "110001001": 8, "110010000": 3, "110010001": 5, "110011000": 1, "110011001": 2, "110011011": 1, "110100000": 1, "110100001": 8, "110101000": 1, "110101101": 1, "110110000": 1, "110110001": 3, "111000000": 1, "111000001": 6, "111010001": 1, "111100001": 2}

total_w2 = sum(walk_d2_full.values())
probs_d2 = [0.0] * N
for bs, c in walk_d2_full.items():
    for q in range(N):
        if bit_at(bs, q) == 1:
            probs_d2[q] += c / total_w2

print("Depth 2 — per-qubit P(|1⟩):")
for q in range(N):
    bar = "█" * int(probs_d2[q] * 50)
    print(f"  q{q}: {probs_d2[q]:.3f} {bar}")

print()
print("=== Walk spreading comparison ===")
print(f"{'Qubit':>6} {'d=0':>6} {'d=1':>6} {'d=2':>6}  topology distance from q0")
d0 = [1.0, 0, 0, 0, 0, 0, 0, 0, 0]
topo_dist = [0, 1, 1, 2, 2, 2, 3, 3, 4]  # BFS distance from q0
for q in range(N):
    print(f"  q{q}:  {d0[q]:.3f}  {probs_d1[q]:.3f}  {probs_d2[q]:.3f}   dist={topo_dist[q]}")
