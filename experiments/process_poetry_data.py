"""Process interference and decoherence hardware results into display data for the poetry page."""
import json
import math

# Word banks for poem mapping
TENDERNESS_LINES = {
    'line1': [
        'your hand finds mine', 'the children sleeping', 'seventeen winters',
        'you laugh and I remember', 'the kitchen light still on', 'your breathing in the dark',
        'we built this room together', 'I know your silences',
    ],
    'line2': [
        'and something holds that should have broken', 'the years have made us porous to each other',
        'I trace the atlas of your changing face', 'the fractures are the places where light enters',
        'we speak a language no one else can hear', 'the bed remembers every shape we\'ve been',
        'four lives grew upward from this tangled root', 'the ordinary days are what I\'ll grieve',
    ],
    'line3': [
        'still, your warmth', 'the door left open', 'bread on the table', 'your scent, the sheets',
        'a hand-worn ring', 'roots under stone', 'two clocks, one time', 'the long way home',
    ],
}

RESENTMENT_LINES = {
    'line1': [
        'your silence fills the room', 'the children watch us watching', 'seventeen years of this',
        'you talk and I stop hearing', 'the kitchen light, still on', 'your breathing keeps me up',
        'we built these walls together', 'I know your evasions',
    ],
    'line2': [
        'and something stays that should have left by now', 'the years have worn us thin as excuses',
        'I count the ways your face has disappointed', 'the fractures are just fractures, nothing more',
        'we speak the same exhausted arguments', 'the bed remembers every turned-away back',
        'four lives demand more than this hollow truce', 'the ordinary days are all there is',
    ],
    'line3': [
        'still, your weight', 'the door slammed shut', 'crumbs on the table', 'your snore, the sheets',
        'a hand-worn groove', 'walls closing in', 'two clocks, no time', 'the long way round',
    ],
}

def bitstring_to_poem(bs, bank):
    g1 = int(bs[6:9], 2)
    g2 = int(bs[3:6], 2)
    g3 = int(bs[0:3], 2)
    return [bank['line1'][g1], bank['line2'][g2], bank['line3'][g3]]

def shannon_entropy(dist):
    total = sum(dist.values())
    H = 0
    for count in dist.values():
        if count > 0:
            p = count / total
            H -= p * math.log2(p)
    return H

def top_poems(dist, bank, n=5):
    total = sum(dist.values())
    sorted_bs = sorted(dist.items(), key=lambda x: -x[1])[:n]
    result = []
    for bs, count in sorted_bs:
        lines = bitstring_to_poem(bs, bank)
        result.append({
            'lines': lines,
            'count': count,
            'prob': round(count / total, 4),
        })
    return result

# ==================================================
# INTERFERENCE DATA
# ==================================================

# Existing Z-basis (θ=0) and X-basis (θ=π/2) distributions
DIST_Z = {"000000000":337,"000000001":91,"000000010":70,"000000011":15,"000000100":31,"000000101":13,"000000110":8,"000000111":5,"000001000":137,"000001001":39,"000001010":25,"000001011":9,"000001100":11,"000001101":2,"000001110":1,"000001111":1,"000010000":204,"000010001":62,"000010010":45,"000010011":8,"000010100":31,"000010101":12,"000010110":6,"000010111":1,"000011000":90,"000011001":30,"000011010":20,"000011011":8,"000011100":9,"000011101":4,"000100000":124,"000100001":39,"000100010":20,"000100011":1,"000100100":14,"000100101":2,"000100110":2,"000100111":1,"000101000":58,"000101001":9,"000101010":7,"000101011":3,"000101100":4,"000101101":1,"000110000":93,"000110001":28,"000110010":15,"000110011":5,"000110100":17,"000110101":3,"000110110":4,"000111000":40,"000111001":8,"000111010":5,"000111100":6,"000111101":3,"001000000":83,"001000001":24,"001000010":8,"001000011":3,"001000100":6,"001000101":2,"001000110":1,"001000111":2,"001001000":31,"001001001":9,"001001010":3,"001001011":1,"001001100":1,"001010000":54,"001010001":15,"001010010":12,"001010011":2,"001010100":4,"001010101":2,"001010110":1,"001011000":23,"001011001":4,"001011010":1,"001011011":2,"001011100":2,"001011110":1,"001100000":31,"001100001":9,"001100010":5,"001100011":2,"001100100":6,"001100101":2,"001100110":1,"001101000":13,"001101001":8,"001101010":2,"001101011":1,"001101100":1,"001110000":25,"001110001":9,"001110010":2,"001110100":5,"001111000":8,"001111001":2,"001111010":2,"010000000":38,"010000001":15,"010000010":4,"010000100":6,"010000101":1,"010001000":23,"010001001":6,"010001010":2,"010001011":3,"010001100":1,"010010000":39,"010010001":10,"010010010":3,"010010011":2,"010010100":5,"010010101":4,"010010110":1,"010011000":17,"010011001":3,"010011010":3,"010011101":2,"010011110":1,"010100000":17,"010100001":2,"010100010":8,"010100100":3,"010100101":3,"010101000":11,"010101001":2,"010101010":1,"010110000":12,"010110001":3,"010110010":2,"010110100":2,"010111000":7,"010111001":1,"010111100":1,"011000000":9,"011000001":3,"011000010":1,"011000011":1,"011001000":4,"011001001":2,"011001010":1,"011001100":1,"011010000":6,"011010001":2,"011010010":2,"011010110":1,"011011000":5,"011011001":1,"011011011":1,"011011101":1,"011100000":7,"011100001":2,"011100010":1,"011100100":1,"011101000":2,"011101001":1,"011110000":6,"011110010":1,"100000000":174,"100000001":78,"100000010":28,"100000011":9,"100000100":21,"100000101":5,"100000110":4,"100000111":1,"100001000":84,"100001001":23,"100001010":12,"100001011":7,"100001100":9,"100001101":3,"100001110":2,"100010000":147,"100010001":38,"100010010":15,"100010011":9,"100010100":13,"100010101":4,"100010110":4,"100011000":58,"100011001":13,"100011010":13,"100011011":2,"100011100":8,"100011110":3,"100100000":65,"100100001":19,"100100010":13,"100100011":1,"100100100":7,"100100110":1,"100101000":41,"100101001":5,"100101010":3,"100101011":3,"100101100":2,"100101101":2,"100101110":1,"100110000":49,"100110001":14,"100110010":11,"100110011":3,"100110100":9,"100110110":2,"100111000":22,"100111001":8,"100111010":1,"100111011":2,"100111100":3,"101000000":33,"101000001":16,"101000010":10,"101000011":5,"101000100":5,"101000101":1,"101000110":1,"101001000":20,"101001001":5,"101001010":5,"101001011":2,"101001100":1,"101010000":38,"101010001":6,"101010010":7,"101010011":3,"101010100":3,"101010101":6,"101011000":11,"101011001":5,"101011010":2,"101011100":2,"101100000":13,"101100001":2,"101100010":3,"101100100":1,"101101000":4,"101101010":2,"101101100":1,"101110000":9,"101110001":6,"101110011":1,"101110100":1,"101110101":1,"101111000":7,"101111001":1,"101111100":1,"101111110":1,"110000000":19,"110000001":8,"110000010":4,"110000011":1,"110000100":5,"110000101":1,"110001000":14,"110001001":1,"110001010":3,"110001100":3,"110001101":1,"110010000":18,"110010001":5,"110010010":3,"110010011":1,"110010100":6,"110010101":1,"110011000":4,"110011001":4,"110011010":3,"110011011":2,"110100000":14,"110100001":3,"110100010":2,"110100011":3,"110100100":1,"110100110":1,"110101000":5,"110101001":1,"110101010":3,"110101100":1,"110110000":6,"110110001":1,"110110010":2,"110110011":1,"110110100":1,"110111000":2,"110111001":2,"111000000":6,"111000001":2,"111000010":1,"111000100":1,"111000101":1,"111001000":2,"111001001":1,"111010000":5,"111010001":1,"111011000":1,"111011001":1,"111011010":1,"111100000":1,"111100001":2,"111101000":2,"111110000":2,"111111000":1}

DIST_X = {"000000000":396,"000000001":53,"000000010":194,"000000011":32,"000000100":296,"000000101":9,"000000110":137,"000000111":9,"000001000":19,"000001001":4,"000001010":10,"000001100":10,"000001110":6,"000001111":1,"000010000":259,"000010001":24,"000010010":14,"000010011":2,"000010100":149,"000010101":12,"000010110":10,"000011000":7,"000011001":1,"000011010":1,"000011100":4,"000100000":51,"000100001":50,"000100010":24,"000100011":18,"000100100":9,"000100101":18,"000100110":9,"000100111":13,"000101000":1,"000101001":2,"000110000":30,"000110001":24,"000110010":1,"000110011":2,"000110100":6,"000110101":10,"000111000":1,"000111001":3,"001000000":71,"001000001":10,"001000010":23,"001000011":4,"001000100":48,"001000101":2,"001000110":19,"001001000":1,"001001011":1,"001001100":1,"001010000":38,"001010001":3,"001010010":2,"001010011":1,"001010100":20,"001010101":4,"001011100":2,"001100000":5,"001100001":6,"001100010":4,"001100011":2,"001100100":3,"001100101":2,"001100110":1,"001100111":1,"001101100":1,"001110000":1,"001110001":2,"001110100":1,"001110101":2,"001111001":1,"010000000":232,"010000001":30,"010000010":331,"010000011":37,"010000100":128,"010000101":11,"010000110":223,"010000111":9,"010001000":7,"010001001":1,"010001010":11,"010001100":7,"010001110":8,"010001111":1,"010010000":16,"010010001":4,"010010010":139,"010010011":13,"010010100":16,"010010101":1,"010010110":77,"010010111":6,"010011000":1,"010011010":3,"010011011":2,"010011100":2,"010011110":3,"010100000":20,"010100001":16,"010100010":42,"010100011":33,"010100100":9,"010100101":7,"010100110":11,"010100111":19,"010101000":1,"010101001":2,"010101011":1,"010101100":1,"010101110":1,"010110000":3,"010110001":5,"010110010":19,"010110011":15,"010110110":6,"010110111":4,"010111011":2,"011000000":39,"011000001":6,"011000010":41,"011000011":6,"011000100":20,"011000110":25,"011001010":2,"011001100":1,"011001110":3,"011010000":1,"011010010":14,"011010011":2,"011010100":6,"011010110":15,"011010111":3,"011011000":1,"011011010":2,"011011110":2,"011100000":3,"011100001":4,"011100010":6,"011100011":7,"011100100":1,"011100101":1,"011100110":1,"011100111":2,"011101010":1,"011110000":1,"011110001":3,"011110010":3,"011110111":2,"100000000":15,"100000001":1,"100000010":5,"100000011":1,"100000100":6,"100000101":2,"100000110":9,"100000111":1,"100010000":4,"100010100":4,"100010110":1,"100100000":1,"100100001":2,"100110001":1,"100110010":1,"101000000":2,"101000001":1,"101000010":2,"101000100":2,"101010000":2,"101100011":2,"101110101":1,"110000000":5,"110000001":1,"110000010":13,"110000011":2,"110000100":4,"110000101":1,"110000110":3,"110001000":1,"110001001":1,"110001110":1,"110010010":6,"110010110":3,"110011010":1,"110011110":1,"110100011":1,"110100100":1,"110100101":1,"110110000":1,"110110001":1,"110110010":2,"110110011":1,"111000000":2,"111010010":1,"111010011":1,"111010110":1,"111100001":1}

# Hardware results
DIST_22 = {"000000000":63,"000000001":41,"000000010":30,"000000011":19,"000000100":29,"000000101":8,"000000110":11,"000000111":2,"000001000":64,"000001001":26,"000001010":40,"000001011":12,"000001100":14,"000001101":3,"000001110":9,"000001111":1,"000010000":116,"000010001":65,"000010010":14,"000010011":6,"000010100":35,"000010101":4,"000010110":4,"000010111":1,"000011000":92,"000011001":44,"000011010":7,"000011011":1,"000011100":26,"000011110":5,"000100000":42,"000100001":25,"000100010":24,"000100011":10,"000100100":4,"000100101":2,"000100110":1,"000100111":1,"000101000":29,"000101001":18,"000101010":18,"000101011":6,"000101100":3,"000101110":2,"000101111":1,"000110000":101,"000110001":56,"000110010":5,"000110011":3,"000110100":7,"000110101":7,"000111000":50,"000111001":33,"000111010":6,"000111011":3,"000111100":3,"001000000":29,"001000001":12,"001000010":7,"001000011":7,"001000100":8,"001000101":1,"001000110":8,"001000111":3,"001001000":22,"001001001":12,"001001010":15,"001001011":3,"001001100":8,"001001101":4,"001001110":3,"001010000":45,"001010001":31,"001010010":3,"001010011":2,"001010100":20,"001010110":1,"001011000":41,"001011001":19,"001011100":10,"001011101":2,"001011110":1,"001100000":22,"001100001":8,"001100010":10,"001100011":3,"001100100":4,"001100101":1,"001100111":1,"001101000":21,"001101001":3,"001101010":8,"001101011":1,"001101100":1,"001110000":36,"001110001":18,"001110010":4,"001110011":1,"001111000":21,"001111001":6,"001111010":4,"001111011":1,"001111100":4,"001111101":1,"010000000":26,"010000001":16,"010000010":15,"010000011":4,"010000100":11,"010000101":2,"010000110":5,"010001000":20,"010001001":9,"010001010":7,"010001011":2,"010001100":4,"010001101":2,"010001110":1,"010010000":9,"010010001":3,"010010100":1,"010010110":1,"010010111":1,"010011000":9,"010011001":3,"010011100":2,"010100000":16,"010100001":10,"010100010":6,"010100011":4,"010100100":1,"010100101":1,"010100111":1,"010101000":11,"010101001":7,"010101010":5,"010101011":1,"010101100":2,"010110000":7,"010110001":1,"010110010":1,"010110011":1,"010110100":1,"010111000":3,"010111001":2,"010111010":1,"010111101":1,"011000000":9,"011000001":7,"011000010":7,"011000011":4,"011000100":3,"011000110":3,"011001000":3,"011001001":2,"011001010":2,"011001011":2,"011001100":3,"011001110":1,"011010000":3,"011010001":3,"011010101":1,"011011000":1,"011011001":3,"011011010":1,"011011100":2,"011011101":1,"011100000":12,"011100001":9,"011100010":3,"011100011":5,"011100110":1,"011101000":8,"011101001":5,"011101010":1,"011101011":5,"011110000":4,"011110001":2,"011110011":1,"011110100":1,"011111000":3,"011111001":1,"100000000":69,"100000001":38,"100000010":37,"100000011":18,"100000100":24,"100000101":5,"100000110":14,"100000111":2,"100001000":54,"100001001":19,"100001010":21,"100001011":7,"100001100":13,"100001101":4,"100001110":5,"100001111":3,"100010000":103,"100010001":63,"100010010":7,"100010011":7,"100010100":32,"100010101":9,"100010110":2,"100010111":2,"100011000":75,"100011001":37,"100011010":2,"100011011":3,"100011100":18,"100011101":7,"100100000":36,"100100001":30,"100100010":19,"100100011":14,"100100100":5,"100100101":3,"100100110":5,"100100111":1,"100101000":18,"100101001":18,"100101010":13,"100101011":7,"100101100":6,"100101101":1,"100110000":78,"100110001":45,"100110010":3,"100110011":1,"100110100":6,"100110101":3,"100111000":70,"100111001":31,"100111010":5,"100111100":5,"100111101":4,"100111110":1,"101000000":26,"101000001":28,"101000010":16,"101000011":5,"101000100":3,"101000101":3,"101000110":4,"101001000":24,"101001001":10,"101001010":15,"101001011":9,"101001100":9,"101001110":1,"101001111":1,"101010000":49,"101010001":17,"101010010":5,"101010011":2,"101010100":7,"101011000":33,"101011001":18,"101011010":2,"101011011":2,"101011100":13,"101011101":2,"101011110":1,"101100000":24,"101100001":13,"101100010":14,"101100011":7,"101100100":4,"101100101":1,"101101000":14,"101101001":9,"101101010":10,"101101011":3,"101101100":2,"101110000":27,"101110001":19,"101110010":1,"101110011":2,"101110100":2,"101110101":1,"101110110":1,"101111000":28,"101111001":15,"101111010":2,"101111100":1,"101111101":1,"110000000":29,"110000001":13,"110000010":12,"110000011":4,"110000100":11,"110000101":2,"110000111":2,"110001000":17,"110001001":15,"110001010":9,"110001011":3,"110001100":6,"110001101":2,"110001110":3,"110010000":7,"110010001":5,"110010010":2,"110010100":3,"110010101":1,"110011000":3,"110011001":2,"110011010":2,"110011100":2,"110100000":17,"110100001":8,"110100010":6,"110100011":9,"110100100":1,"110101000":14,"110101001":14,"110101010":2,"110101100":1,"110101111":1,"110110000":5,"110110001":1,"110110010":1,"110110011":1,"110110100":1,"110110101":1,"110111000":7,"110111001":1,"110111011":1,"111000000":12,"111000001":9,"111000010":5,"111000011":2,"111000100":2,"111000101":1,"111001000":13,"111001001":4,"111001010":5,"111001011":2,"111001100":2,"111001110":1,"111010000":3,"111010100":1,"111010101":1,"111011000":5,"111011010":1,"111011011":1,"111100000":11,"111100001":4,"111100010":2,"111100011":1,"111100110":1,"111101000":4,"111101001":3,"111101010":3,"111101011":2,"111101111":1,"111110000":1,"111110001":1,"111110100":1,"111111000":2,"111111001":2}

DIST_45 = {"000000000":208,"000000001":57,"000000010":29,"000000011":9,"000000100":21,"000000101":34,"000000110":4,"000000111":7,"000001000":112,"000001001":24,"000001010":20,"000001011":5,"000001100":10,"000001101":12,"000001110":1,"000001111":5,"000010000":90,"000010001":15,"000010010":75,"000010011":21,"000010100":5,"000010101":12,"000010110":3,"000010111":19,"000011000":48,"000011001":7,"000011010":40,"000011011":12,"000011100":8,"000011101":2,"000011110":4,"000011111":6,"000100000":81,"000100001":42,"000100010":12,"000100011":2,"000100100":29,"000100101":6,"000100110":11,"000101000":26,"000101001":22,"000101010":5,"000101011":6,"000101100":17,"000101101":8,"000101110":2,"000110000":26,"000110001":16,"000110010":26,"000110011":18,"000110100":14,"000110101":3,"000110110":23,"000111000":20,"000111001":6,"000111010":10,"000111011":5,"000111100":10,"000111101":1,"000111110":11,"000111111":1,"001000000":79,"001000001":26,"001000010":19,"001000011":2,"001000100":5,"001000101":18,"001000110":1,"001000111":3,"001001000":43,"001001001":10,"001001010":7,"001001100":2,"001001101":5,"001010000":38,"001010001":3,"001010010":27,"001010011":6,"001010100":6,"001010101":6,"001010110":2,"001010111":7,"001011000":18,"001011001":4,"001011010":21,"001011011":5,"001011100":2,"001011101":3,"001100000":29,"001100001":11,"001100010":4,"001100011":2,"001100100":19,"001100101":1,"001100110":2,"001100111":1,"001101000":15,"001101001":8,"001101010":3,"001101100":7,"001101110":1,"001101111":2,"001110000":15,"001110001":3,"001110010":12,"001110011":5,"001110100":4,"001110110":6,"001110111":1,"001111000":8,"001111001":3,"001111010":4,"001111011":5,"001111100":1,"001111101":1,"001111110":1,"010000000":24,"010000001":5,"010000010":12,"010000011":8,"010000100":4,"010000101":10,"010000110":2,"010000111":4,"010001000":15,"010001001":4,"010001010":14,"010001011":4,"010001101":1,"010001110":1,"010001111":4,"010010000":53,"010010001":22,"010010010":16,"010010011":4,"010010100":3,"010010101":21,"010010110":3,"010010111":2,"010011000":32,"010011001":7,"010011010":6,"010011011":2,"010011100":3,"010011101":4,"010011111":2,"010100000":5,"010100001":2,"010100010":5,"010100011":1,"010100100":6,"010100110":3,"010101000":5,"010101001":2,"010101010":3,"010101011":1,"010101110":2,"010110000":38,"010110001":12,"010110010":8,"010110011":6,"010110100":19,"010110101":1,"010110110":2,"010111000":9,"010111001":5,"010111010":3,"010111100":4,"010111110":1,"011000000":5,"011000001":2,"011000010":11,"011000011":4,"011000110":1,"011000111":2,"011001000":4,"011001001":1,"011001010":2,"011001011":1,"011010000":31,"011010001":4,"011010010":6,"011010011":1,"011010101":5,"011010111":2,"011011000":10,"011011001":6,"011011010":1,"011011100":1,"011011101":5,"011011110":1,"011100000":5,"011100001":3,"011100010":3,"011100011":4,"011100110":1,"011101000":3,"011101001":2,"011101010":2,"011101011":2,"011101110":2,"011110000":5,"011110001":7,"011110010":2,"011110011":4,"011110100":5,"011110101":1,"011111000":3,"011111001":1,"011111011":1,"011111100":3,"011111101":2,"100000000":146,"100000001":35,"100000010":25,"100000011":6,"100000100":12,"100000101":38,"100000111":2,"100001000":68,"100001001":10,"100001010":10,"100001011":2,"100001100":4,"100001101":16,"100001110":2,"100010000":44,"100010001":11,"100010010":45,"100010011":9,"100010100":5,"100010101":14,"100010110":3,"100010111":3,"100011000":22,"100011001":5,"100011010":20,"100011011":3,"100011100":3,"100011101":1,"100011110":1,"100011111":4,"100100000":50,"100100001":35,"100100010":4,"100100011":5,"100100100":28,"100100101":1,"100100110":4,"100100111":1,"100101000":24,"100101001":11,"100101010":6,"100101011":2,"100101100":15,"100101101":3,"100110000":18,"100110001":14,"100110010":13,"100110011":10,"100110100":20,"100110110":15,"100110111":1,"100111000":10,"100111001":6,"100111010":7,"100111011":1,"100111100":6,"100111101":1,"100111110":6,"100111111":1,"101000000":55,"101000001":14,"101000010":8,"101000100":4,"101000101":12,"101000110":1,"101000111":2,"101001000":33,"101001001":2,"101001010":2,"101001011":1,"101001100":1,"101001101":2,"101001111":1,"101010000":19,"101010001":3,"101010010":22,"101010011":4,"101010100":1,"101010101":2,"101010110":1,"101010111":3,"101011000":14,"101011001":2,"101011010":11,"101011011":1,"101011101":1,"101011110":1,"101011111":1,"101100000":17,"101100001":9,"101100010":2,"101100100":20,"101100101":3,"101100110":1,"101100111":1,"101101000":9,"101101001":4,"101101010":1,"101101100":6,"101101101":1,"101110000":7,"101110001":4,"101110010":5,"101110011":3,"101110100":4,"101110101":1,"101110110":5,"101111001":1,"101111010":2,"101111011":2,"101111100":1,"101111110":1,"110000000":10,"110000001":6,"110000010":7,"110000011":4,"110000101":3,"110000111":1,"110001000":6,"110001001":1,"110001010":2,"110001011":2,"110001101":1,"110001110":1,"110010000":33,"110010001":6,"110010010":10,"110010011":5,"110010100":3,"110010101":6,"110011000":19,"110011001":9,"110011010":3,"110011011":1,"110011100":1,"110011101":5,"110100000":10,"110100001":5,"110100010":7,"110100011":4,"110100100":3,"110100110":1,"110100111":1,"110101000":2,"110101010":3,"110101011":1,"110101100":1,"110101110":2,"110101111":1,"110110000":11,"110110001":14,"110110010":2,"110110100":8,"110110101":2,"110111000":3,"110111001":2,"110111011":2,"110111100":6,"111000000":6,"111000001":2,"111000010":3,"111000011":3,"111000101":2,"111000110":2,"111000111":1,"111001000":5,"111001010":3,"111001111":1,"111010000":17,"111010001":8,"111010010":2,"111010100":2,"111010101":3,"111010110":1,"111010111":1,"111011000":7,"111011001":3,"111011010":1,"111011100":1,"111011101":2,"111100010":2,"111100100":3,"111100110":1,"111101010":2,"111101011":1,"111101100":2,"111101110":1,"111110000":8,"111110001":1,"111110010":2,"111110011":1,"111110100":3,"111110101":1,"111111000":3,"111111010":2,"111111011":1,"111111110":1}

DIST_68 = {"000000000":678,"000000001":93,"000000010":155,"000000011":15,"000000100":193,"000000101":62,"000000110":47,"000000111":11,"000001000":75,"000001001":9,"000001010":18,"000001011":3,"000001100":26,"000001101":9,"000001110":6,"000001111":1,"000010000":45,"000010001":9,"000010010":139,"000010011":19,"000010100":16,"000010101":2,"000010110":49,"000010111":7,"000011000":5,"000011010":12,"000011011":5,"000011110":4,"000011111":1,"000100000":89,"000100001":6,"000100010":14,"000100011":1,"000100100":66,"000100101":59,"000100110":18,"000100111":14,"000101000":9,"000101010":3,"000101100":2,"000101101":4,"000101111":3,"000110000":7,"000110001":2,"000110010":18,"000110011":5,"000110100":1,"000110101":3,"000110110":13,"000110111":14,"000111000":1,"000111010":3,"000111101":1,"000111110":2,"000111111":3,"001000000":123,"001000001":12,"001000010":22,"001000011":3,"001000100":33,"001000101":5,"001000110":7,"001000111":1,"001001000":10,"001001001":1,"001001010":1,"001001100":3,"001001101":2,"001010000":7,"001010001":1,"001010010":23,"001010011":3,"001010100":3,"001010101":1,"001010110":6,"001010111":1,"001011010":2,"001011110":3,"001011111":2,"001100000":9,"001100010":3,"001100100":8,"001100101":6,"001100110":3,"001100111":3,"001101000":1,"001101101":1,"001110010":6,"001110100":2,"001110101":1,"001110111":1,"001111101":1,"001111111":1,"010000000":163,"010000001":19,"010000010":23,"010000011":6,"010000100":54,"010000101":13,"010000110":4,"010001000":29,"010001001":2,"010001010":7,"010001011":1,"010001100":6,"010001101":1,"010001110":2,"010010000":98,"010010001":19,"010010010":185,"010010011":22,"010010100":43,"010010101":7,"010010110":57,"010010111":9,"010011000":16,"010011010":28,"010011011":2,"010011100":6,"010011110":9,"010011111":2,"010100000":14,"010100001":1,"010100010":3,"010100100":14,"010100101":13,"010100110":4,"010100111":2,"010101000":6,"010101001":1,"010101010":1,"010101100":2,"010101101":5,"010101110":1,"010110000":13,"010110001":1,"010110010":27,"010110011":6,"010110100":7,"010110101":9,"010110110":16,"010110111":20,"010111000":2,"010111001":1,"010111010":4,"010111100":1,"010111110":1,"010111111":2,"011000000":29,"011000001":3,"011000010":3,"011000011":1,"011000100":4,"011000101":1,"011000110":2,"011001000":3,"011001001":1,"011001010":1,"011001100":1,"011010000":20,"011010001":1,"011010010":26,"011010011":3,"011010100":8,"011010101":1,"011010110":8,"011010111":1,"011011000":2,"011011010":3,"011011011":2,"011100000":4,"011100100":3,"011100101":1,"011110000":2,"011110010":3,"011110100":1,"011110101":1,"011110110":5,"011110111":2,"100000000":128,"100000001":7,"100000010":27,"100000011":2,"100000100":33,"100000101":6,"100000110":6,"100000111":2,"100001000":17,"100001001":1,"100001010":3,"100001100":4,"100010000":7,"100010010":17,"100010011":6,"100010100":1,"100010110":3,"100010111":3,"100011000":1,"100011001":2,"100011010":1,"100011110":1,"100100000":16,"100100001":2,"100100010":2,"100100011":2,"100100100":10,"100100101":11,"100100110":3,"100100111":1,"100101000":2,"100101100":3,"100101110":1,"100110000":1,"100110010":2,"100110111":2,"100111000":1,"101000000":16,"101000010":5,"101000100":9,"101000101":1,"101000110":2,"101001000":1,"101010010":6,"101010111":2,"101100000":2,"101100100":1,"101110110":1,"110000000":20,"110000001":2,"110000010":5,"110000100":6,"110000101":3,"110001000":4,"110001100":3,"110010000":13,"110010001":5,"110010010":25,"110010011":3,"110010100":4,"110010110":5,"110010111":2,"110011000":2,"110011001":1,"110011010":4,"110011011":2,"110011100":1,"110011110":3,"110100000":2,"110100100":2,"110100101":2,"110100110":2,"110101010":1,"110101101":1,"110110010":1,"110110101":1,"110110110":5,"110110111":4,"110111110":1,"111000000":4,"111000101":1,"111000110":1,"111010000":6,"111010010":8,"111010100":1,"111011110":1,"111101100":1,"111110010":1,"111110101":1,"111110111":1}

# Decoherence results
DIST_GHZ3 = {"000000000":1920,"000000001":26,"000000010":2,"000000100":15,"000000101":1,"000001000":46,"000001001":2,"000001010":41,"000001110":2,"000010000":44,"000010010":150,"000010011":1,"000010110":2,"000011000":54,"000011001":3,"000011010":1625,"000011011":19,"000011100":1,"000011110":16,"000100000":15,"000101000":1,"000110010":1,"000111000":1,"000111010":16,"001000000":11,"001000001":1,"001001010":1,"001010000":2,"001010010":2,"001011001":1,"001011010":13,"001111010":1,"010000000":27,"010010000":1,"010010010":2,"010011000":2,"010011010":19,"010011011":1,"010011110":2,"011011010":1,"100000000":3,"100001010":1,"100011010":1}

DIST_GHZ5 = {"000000000":1849,"000000001":23,"000000010":10,"000000100":22,"000000101":1,"000000110":1,"000001000":50,"000001001":3,"000001010":16,"000001100":1,"000001110":1,"000010000":16,"000010001":1,"000010010":4,"000010110":4,"000011000":3,"000011010":26,"000011100":1,"000011110":48,"000100000":34,"000100010":2,"000100100":12,"000100110":1,"000101010":2,"000101100":3,"000101110":25,"000101111":1,"000110010":7,"000110100":27,"000110101":1,"000110110":172,"000110111":2,"000111000":3,"000111010":49,"000111011":3,"000111100":72,"000111101":1,"000111110":1472,"000111111":14,"001000000":20,"001000010":1,"001000100":1,"001001000":1,"001010000":1,"001101100":1,"001101110":1,"001110110":3,"001111010":1,"001111110":16,"010000000":26,"010001000":2,"010011100":1,"010101110":2,"010110100":1,"010110110":1,"010111100":1,"010111110":21,"100000000":3,"100011010":1,"100111110":8}

DIST_GHZ7 = {"000000000":1854,"000000001":26,"000000010":9,"000000100":21,"000001000":53,"000001010":20,"000001100":2,"000001110":1,"000010000":15,"000010010":8,"000010100":1,"000010110":2,"000011000":1,"000011001":1,"000011010":26,"000011011":1,"000011110":18,"000100000":11,"000101000":1,"000101001":1,"000101010":1,"000101110":2,"000110100":3,"000110110":4,"000111100":1,"000111110":23,"001000000":15,"001011010":1,"001101000":1,"010000000":18,"010000001":2,"010000100":1,"010001000":2,"010010110":1,"010011110":2,"010100000":2,"010100100":1,"010101110":1,"010110000":1,"010110100":2,"010110101":1,"010110110":10,"010111010":9,"010111100":4,"010111110":79,"011110110":1,"100000000":20,"100001000":2,"100001010":1,"100010000":1,"100011010":1,"100011100":1,"100011110":1,"100100000":1,"100110110":3,"100111010":1,"100111100":2,"100111110":40,"101111110":2,"110000000":12,"110000010":1,"110000100":2,"110001010":3,"110001100":1,"110001110":1,"110010100":2,"110010110":11,"110011000":1,"110011010":3,"110011100":3,"110011101":1,"110011110":59,"110011111":1,"110100000":11,"110100100":12,"110100110":1,"110101010":1,"110101100":3,"110101110":31,"110101111":1,"110110000":1,"110110010":2,"110110100":22,"110110101":2,"110110110":159,"110110111":2,"110111000":1,"110111001":1,"110111010":49,"110111011":1,"110111100":81,"110111101":2,"110111110":1247,"110111111":14,"111110110":1,"111111100":1,"111111110":11,"111111111":2}

DIST_GHZ9 = {"000000000":1427,"000000001":7,"000000010":13,"000000100":4,"000000111":1,"000001000":360,"000001001":6,"000001010":5,"000001011":4,"000001100":2,"000001101":1,"000010000":33,"000010001":1,"000011000":7,"000100000":29,"000100001":2,"000100100":14,"000100101":23,"000100110":1,"000100111":12,"000101000":8,"000101001":3,"000101011":2,"000101100":3,"000101101":27,"000101110":3,"000101111":18,"000110000":1,"000110111":4,"000111111":2,"001000000":33,"001000010":1,"001000100":1,"001001000":9,"001001100":1,"001010000":5,"001100000":3,"001100101":1,"001100111":5,"001101011":1,"001101101":2,"001101110":1,"001101111":17,"001111011":1,"001111101":1,"001111110":2,"001111111":26,"010000000":20,"010001000":6,"010010000":1,"010011000":1,"010101111":1,"010110110":1,"010111111":4,"011000000":2,"011000011":1,"011001000":1,"011010000":1,"011010010":4,"011011000":1,"011011010":3,"011011011":1,"011011111":2,"011101111":2,"011110101":3,"011110110":2,"011110111":17,"011111011":6,"011111101":2,"011111110":6,"011111111":55,"100000000":10,"100000001":1,"100001000":3,"100100111":1,"100101011":1,"100101101":1,"100110110":1,"100110111":1,"100111111":4,"101000000":2,"101001000":1,"101011010":1,"101011111":1,"101100000":1,"101100111":1,"101110111":3,"101111011":2,"101111110":5,"101111111":22,"110000000":10,"110001000":5,"110010000":3,"110010010":1,"110010011":1,"110011000":3,"110011010":4,"110011011":1,"110011111":2,"110100111":1,"110101011":2,"110101111":5,"110110011":1,"110110101":2,"110110110":1,"110110111":23,"110111011":6,"110111100":1,"110111101":3,"110111110":6,"110111111":72,"111000000":1,"111000010":2,"111001000":1,"111001010":1,"111001110":2,"111001111":2,"111010000":12,"111010010":19,"111010011":4,"111010100":1,"111010101":2,"111010111":5,"111011000":2,"111011001":2,"111011010":27,"111011011":23,"111011101":1,"111011110":1,"111011111":25,"111100001":1,"111100011":1,"111100110":1,"111100111":3,"111101011":1,"111101110":3,"111101111":20,"111110000":1,"111110001":1,"111110010":1,"111110011":12,"111110101":11,"111110110":18,"111110111":297,"111111000":1,"111111001":3,"111111010":4,"111111011":34,"111111100":4,"111111101":42,"111111110":77,"111111111":936}


# ==================================================
# PROCESS INTERFERENCE
# ==================================================

dists = [DIST_Z, DIST_22, DIST_45, DIST_68, DIST_X]
angle_labels = ['0', '22.5', '45', '67.5', '90']

print("=== INTERFERENCE DATA ===\n")

for i, (dist, label) in enumerate(zip(dists, angle_labels)):
    total = sum(dist.values())
    unique = len(dist)
    entropy = shannon_entropy(dist)

    # Top 5 bitstrings
    sorted_bs = sorted(dist.items(), key=lambda x: -x[1])[:5]

    print(f"θ={label}°: {unique} unique, entropy={entropy:.2f} bits, total={total}")
    for bs, count in sorted_bs:
        t_poem = bitstring_to_poem(bs, TENDERNESS_LINES)
        r_poem = bitstring_to_poem(bs, RESENTMENT_LINES)
        prob = count / total
        print(f"  {bs}: {count} ({prob:.1%})")
        print(f"    T: {t_poem[0]} / {t_poem[1]} / {t_poem[2]}")
        print(f"    R: {r_poem[0]} / {r_poem[1]} / {r_poem[2]}")
    print()

# ==================================================
# PROCESS DECOHERENCE
# ==================================================

print("=== DECOHERENCE DATA ===\n")

# GHZ configs: which qubits are involved, and what the "all-one" bitstring looks like
# Path: 3→1→4→2→5→7→8→6
# GHZ-3: q3, q1, q4 — in 9-bit MSB string, q3=bit5, q1=bit7, q4=bit4
# all-zero: 000000000, all-one: bits 4,5,7 set = 010110000? No...
# Wait — MSB first means bit[0]=q8, bit[1]=q7, ..., bit[8]=q0
# So q3 = bit[8-3] = bit[5], q1 = bit[8-1] = bit[7], q4 = bit[8-4] = bit[4]
# All-one for {q3,q1,q4}: bit[5]=1, bit[7]=1, bit[4]=1
# Position 5 from MSB: ___1_0000 → bit5=1 means position 5 (0-indexed from left)
# 000000000
# 012345678
# bit[4]=1: position 4 from left → 00001xxxx
# bit[5]=1: position 5 from left → 000001xxx
# bit[7]=1: position 7 from left → 0000000x1... no

# Let me be more careful. The bitstring is "b0 b1 b2 b3 b4 b5 b6 b7 b8"
# where b0 is the leftmost character
# b[i] represents qubit 8-i (MSB first convention)
# So b[0] = q8, b[1] = q7, b[2] = q6, b[3] = q5, b[4] = q4, b[5] = q3, b[6] = q2, b[7] = q1, b[8] = q0

# GHZ-3: qubits {q3, q1, q4}
# q3 → b[5], q1 → b[7], q4 → b[4]
# All-one: b[4]=1, b[5]=1, b[7]=1 → 000011010

ghz_configs = [
    {
        'label': 'GHZ-3',
        'qubits': [3, 1, 4],
        'dist': DIST_GHZ3,
        # all-one positions in 9-bit string: b[5]=1 (q3), b[7]=1 (q1), b[4]=1 (q4)
        'ideal_one': '000011010',
        'n_cz': 2,
    },
    {
        'label': 'GHZ-5',
        'qubits': [3, 1, 4, 2, 5],
        'dist': DIST_GHZ5,
        # q3→b[5], q1→b[7], q4→b[4], q2→b[6], q5→b[3]
        'ideal_one': '000111110',
        'n_cz': 4,
    },
    {
        'label': 'GHZ-7',
        'qubits': [3, 1, 4, 2, 5, 7, 8],
        'dist': DIST_GHZ7,
        # q3→b[5], q1→b[7], q4→b[4], q2→b[6], q5→b[3], q7→b[1], q8→b[0]
        'ideal_one': '110111110',
        'n_cz': 6,
    },
    {
        'label': 'GHZ-9',
        'qubits': [0, 1, 2, 3, 4, 5, 6, 7, 8],
        'dist': DIST_GHZ9,
        'ideal_one': '111111111',
        'n_cz': 8,
    },
]

for cfg in ghz_configs:
    dist = cfg['dist']
    total = sum(dist.values())
    unique = len(dist)
    entropy = shannon_entropy(dist)

    zero_count = dist.get('000000000', 0)
    one_count = dist.get(cfg['ideal_one'], 0)
    fidelity = (zero_count + one_count) / total

    print(f"{cfg['label']}: {cfg['n_cz']} CZ gates")
    print(f"  Fidelity: {fidelity:.4f} ({fidelity*100:.1f}%)")
    print(f"  |000000000⟩: {zero_count} ({zero_count/total*100:.1f}%)")
    print(f"  |{cfg['ideal_one']}⟩: {one_count} ({one_count/total*100:.1f}%)")
    print(f"  Unique outcomes: {unique}")
    print(f"  Entropy: {entropy:.3f} bits")

    # Top 3 poems (tenderness reading)
    sorted_bs = sorted(dist.items(), key=lambda x: -x[1])[:5]
    for bs, count in sorted_bs:
        poem = bitstring_to_poem(bs, TENDERNESS_LINES)
        print(f"  {bs}: {count} — {poem[0]} / {poem[1]} / {poem[2]}")
    print()

# ==================================================
# Generate JSON for easy TypeScript conversion
# ==================================================

interference_output = []
for i, (dist, label) in enumerate(zip(dists, angle_labels)):
    total = sum(dist.values())
    sorted_bs = sorted(dist.items(), key=lambda x: -x[1])[:10]
    top = []
    for bs, count in sorted_bs:
        t = bitstring_to_poem(bs, TENDERNESS_LINES)
        r = bitstring_to_poem(bs, RESENTMENT_LINES)
        top.append({
            'bitstring': bs,
            'count': count,
            'prob': round(count / total, 4),
            'tenderness': t,
            'resentment': r,
        })
    interference_output.append({
        'angle': float(label),
        'unique': len(dist),
        'entropy': round(shannon_entropy(dist), 2),
        'top': top,
    })

decoherence_output = []
for cfg in ghz_configs:
    dist = cfg['dist']
    total = sum(dist.values())
    zero_count = dist.get('000000000', 0)
    one_count = dist.get(cfg['ideal_one'], 0)
    fidelity = (zero_count + one_count) / total

    sorted_bs = sorted(dist.items(), key=lambda x: -x[1])[:5]
    top = []
    for bs, count in sorted_bs:
        poem = bitstring_to_poem(bs, TENDERNESS_LINES)
        top.append({
            'lines': poem,
            'count': count,
            'prob': round(count / total, 4),
            'bitstring': bs,
        })

    decoherence_output.append({
        'label': cfg['label'],
        'n_qubits': len(cfg['qubits']),
        'n_cz': cfg['n_cz'],
        'fidelity': round(fidelity, 4),
        'entropy': round(shannon_entropy(dist), 3),
        'unique': len(dist),
        'ideal_zero': '000000000',
        'ideal_one': cfg['ideal_one'],
        'zero_count': zero_count,
        'one_count': one_count,
        'top': top,
    })

print("\n=== JSON OUTPUT ===\n")
print("// interferenceData:")
print(json.dumps(interference_output, indent=2))
print("\n// decoherenceData:")
print(json.dumps(decoherence_output, indent=2))
